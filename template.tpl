// Copyright 2021 Jooble CIS LLC

// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at

//     https://www.apache.org/licenses/LICENSE-2.0

// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Jooble conversion",
  "categories": ["CONVERSIONS"],
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d"
  },
  "description": "Tracks user conversion",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Введіть код шаблона тут.
const sendPixel = require('sendPixel');
const localStorage = require('localStorage');
const getTimestampMillis = require('getTimestampMillis');
const JSON = require('JSON');
const convKey = 'jbl_conv_url';

const jbl_getWithExpiry = (key) => {
  const itemStr = localStorage.getItem(key);
  // if the item doesn't exist, return null
  if (!itemStr)
    return null;

  const item = JSON.parse(itemStr);
  const now_mils = getTimestampMillis();
  // compare the expiry time of the item with the current time
  if (now_mils > item.expiry) {
    // If the item is expired, delete the item from storage
    // and return null
    localStorage.removeItem(key);
    return null;
  }
  
  return item.value;
};

const conversionUrl = jbl_getWithExpiry(convKey);
if (!conversionUrl) {
  data.gtmOnFailure();
  return;
}

sendPixel(conversionUrl);

// remove from localStorage to avoid duplication in conversions in second apply
localStorage.removeItem(convKey);

// Зробіть виклик data.gtmOnSuccess після виконання тегу.
data.gtmOnSuccess();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "access_local_storage",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "jbl_conv_url"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_pixel",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://*.jooble.org/auction/api/conversion/js_pixel*"
              },
              {
                "type": 1,
                "string": "https://jooble.org/auction/api/conversion/js_pixel*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 9/2/2022, 1:09:26 PM

